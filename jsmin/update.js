plugin("HTTP");plugin("ZIP");var homeServerURLs=["http://192.168.40.110/d/openaf/latest","http://172.25.1.32/d/openaf/latest"],homeServerURLs2=["http://192.168.40.110/d/openaf/release","http://172.25.1.32/d/openaf/release"],updateURLs=["http://192.168.40.110/d/openaf","http://172.25.1.32/d/openaf"],currentVersion=getVersion();function updateURL(a,b){return updateURLs[a]+"/openaf-"+b+".zip"}noHomeComms&&(log("Update functionality has been disabled on this restricted release."),exit(0));log("Update to the latest version");
log("Current version = "+currentVersion);try{var curDir=java.lang.System.getProperty("user.dir")+"",classPath=java.lang.System.getProperty("java.class.path")+""}catch(a){logErr("Couldn't retrieve system properties: "+a.message),java.lang.System.exit(0)}
for(var i in homeServerURLs){var homeServerURL=homeServerURLs[i],homeServerURL2=homeServerURLs2[i];log("Trying to contact OpenAF home server = '"+homeServerURL+"'");try{var homeServer=new HTTP(homeServerURL,void 0,void 0,void 0,!1,5E3),latestVersion=homeServer.response().trim(),homeServer2=new HTTP(homeServerURL2,void 0,void 0,void 0,!1,5E3),latestVersion2=homeServer2.response().trim();log("Latest base version = "+latestVersion+" (build "+latestVersion2+")");var force=!1,j;for(j in __args)__args[j].matches("--force")&&
(force=!0);if(latestVersion2>currentVersion||force){latestVersion2>currentVersion?log("There is a newer version. Downloading it from "+updateURL(i,latestVersion)+". This may take some seconds."):log("Downloading it from "+updateURL(i,latestVersion)+". This may take some seconds.");var down=new HTTP(updateURL(i,latestVersion),"GET","",{},!0,5E3);log("Processing download.");var zip=new ZIP;zip.load(down.responseBytes());var oldVersionFile=classPath.replace(/openaf.jar/,"openaf.jar.old");log("Backup current version to "+
oldVersionFile);af.writeFileBytes(oldVersionFile,af.readFileBytes(classPath));log("Upgrading openaf.jar");try{af.writeFileBytes(classPath.replace(/openaf.jar/,"openaf.jar"),zip.getFile("openaf.jar"))}catch(a){if(!a.message.match(/NoClassDefFoundError/))throw a;}zip.close()}else log("This is an updated version. No update needed.");break}catch(a){logErr("Error while updating OpenAF: "+a.message)}}log("Done updating to the latest version.");log("Trying to --repack");af.restartOpenAF(["--repack"]);
